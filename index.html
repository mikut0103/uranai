<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âœˆï¸ tabisora - æ—…ã®ã—ãŠã‚Šãƒ¡ãƒ¼ã‚«ãƒ¼</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Zen+Maru+Gothic:wght@400;700;900&family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root {
  --sky0: #0a1628;
  --sky1: #1a3a6b;
  --sky2: #2e6eb5;
  --sky3: #88c1e8;
  --accent: #ffdd57;
  --pink: #ff6b9d;
  --salmon: #ff7c5c;
  --mint: #7fffd4;
  --cream: #fffef8;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Noto Sans JP', sans-serif;
  min-height: 100vh;
  background: linear-gradient(180deg, var(--sky0) 0%, var(--sky1) 38%, var(--sky2) 68%, var(--sky3) 84%, #c8e8f8 94%, #e8f4fb 100%);
  overflow-x: hidden;
}

/* ===== STARS ===== */
#stars { position:fixed; top:0; left:0; right:0; height:55%; pointer-events:none; z-index:0; }
.star {
  position:absolute; background:white; border-radius:50%;
  animation: twinkle var(--d) var(--dl) infinite alternate;
}
@keyframes twinkle { from{opacity:.1} to{opacity:1} }

/* ===== CLOUDS ===== */
#clouds { position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden; }
.cloud {
  position:absolute; background:white; border-radius:60px;
  animation: drift var(--d) var(--dl) linear infinite;
}
@keyframes drift { from{transform:translateX(-300px)} to{transform:translateX(calc(100vw + 300px))} }

/* ===== PLANE ===== */
#plane {
  position:fixed; top:17%; font-size:2.4rem; z-index:5; pointer-events:none;
  filter: drop-shadow(0 4px 12px rgba(0,0,0,.3));
  animation: planeFly 20s linear infinite, planeWobble 4s ease-in-out infinite;
}
@keyframes planeFly { from{left:-100px} to{left:calc(100vw + 100px)} }
@keyframes planeWobble { 0%,100%{transform:rotate(4deg) translateY(0)} 50%{transform:rotate(-2deg) translateY(-12px)} }

/* ===== LAYOUT ===== */
#app {
  position:relative; z-index:10;
  max-width:480px; margin:0 auto;
  padding:0 16px 60px;
}

/* ===== HEADER ===== */
.header {
  text-align:center; padding:64px 0 36px;
  animation: fadeUp .8s ease;
}
.logo {
  font-family:'Pacifico',cursive; font-size:3rem; color:var(--accent);
  text-shadow: 0 4px 20px rgba(255,221,87,.5), 0 2px 4px rgba(0,0,0,.3);
}
.tagline {
  color:rgba(255,255,255,.72); font-size:.8rem;
  letter-spacing:3px; text-transform:uppercase; margin-top:7px;
}

/* ===== GLASS CARD ===== */
.glass {
  background:rgba(255,255,255,.11);
  backdrop-filter:blur(22px); -webkit-backdrop-filter:blur(22px);
  border:1px solid rgba(255,255,255,.28);
  border-radius:28px; padding:28px 22px;
  box-shadow:0 20px 60px rgba(0,0,0,.3);
  animation: fadeUp .8s ease .15s both;
}

.card-title {
  text-align:center; color:white;
  font-family:'Zen Maru Gothic',sans-serif; font-weight:700;
  font-size:1.1rem; margin-bottom:24px;
}

/* ===== FIELDS ===== */
.field { margin-bottom:18px; }
.field label {
  display:block; color:rgba(255,255,255,.88);
  font-size:.74rem; font-weight:700;
  letter-spacing:2px; text-transform:uppercase;
  margin-bottom:8px;
}
.field input, .field select, .field textarea {
  width:100%; border-radius:14px; padding:12px 15px;
  border:1.5px solid rgba(255,255,255,.22);
  background:rgba(255,255,255,.13);
  color:white; font-family:'Noto Sans JP',sans-serif;
  font-size:.93rem; outline:none;
  transition:border-color .25s, background .25s, box-shadow .25s;
}
.field select { background:rgba(20,50,110,.85); cursor:pointer; }
.field textarea { resize:none; }
.field input::placeholder, .field textarea::placeholder { color:rgba(255,255,255,.35); }
.field input:focus, .field select:focus, .field textarea:focus {
  border-color:var(--accent);
  background:rgba(255,255,255,.2);
  box-shadow:0 0 20px rgba(255,221,87,.2);
}

/* ===== PILLS ===== */
.pills { display:flex; flex-wrap:wrap; gap:7px; }
.pill {
  padding:7px 13px; border-radius:100px;
  border:1.5px solid rgba(255,255,255,.28);
  background:rgba(255,255,255,.1); color:rgba(255,255,255,.82);
  font-size:.79rem; cursor:pointer;
  transition:all .22s; user-select:none;
  font-family:'Noto Sans JP',sans-serif;
}
.pill:hover { border-color:var(--accent); color:var(--accent); }
.pill.on {
  background:var(--accent); border-color:var(--accent);
  color:#1a3a6b; font-weight:700;
  box-shadow:0 4px 14px rgba(255,221,87,.42);
}

/* ===== TRANSPORT ===== */
.transports { display:flex; gap:8px; flex-wrap:wrap; }
.tp {
  flex:1; min-width:66px; text-align:center;
  padding:10px 6px; border-radius:14px;
  border:1.5px solid rgba(255,255,255,.26);
  background:rgba(255,255,255,.1); color:rgba(255,255,255,.82);
  font-size:.74rem; cursor:pointer;
  transition:all .22s; user-select:none;
  font-family:'Noto Sans JP',sans-serif;
}
.tp .ic { font-size:1.4rem; display:block; margin-bottom:3px; }
.tp:hover { border-color:var(--mint); }
.tp.on {
  background:var(--mint); border-color:var(--mint);
  color:#083828; font-weight:700;
  box-shadow:0 4px 14px rgba(127,255,212,.32);
}

/* ===== ERROR ===== */
.err {
  display:none; margin-top:12px;
  background:rgba(255,70,70,.18); border:1px solid rgba(255,70,70,.38);
  border-radius:13px; padding:11px 15px;
  color:#ffaaaa; font-size:.84rem; text-align:center;
}
.err.show { display:block; }

/* ===== SUBMIT ===== */
.btn-submit {
  width:100%; margin-top:22px; padding:15px;
  border:none; border-radius:100px;
  background:linear-gradient(135deg, var(--accent), var(--salmon));
  color:#1a3a6b; font-family:'Zen Maru Gothic',sans-serif;
  font-weight:900; font-size:1.05rem; cursor:pointer;
  box-shadow:0 8px 28px rgba(255,221,87,.4);
  transition:transform .25s, box-shadow .25s;
}
.btn-submit:hover { transform:translateY(-2px); box-shadow:0 14px 38px rgba(255,221,87,.58); }
.btn-submit:active { transform:none; }

/* ===== LOADING ===== */
#loading { display:none; text-align:center; padding:70px 0; animation:fadeUp .5s ease; }
#loading.show { display:block; }
.plane-bounce { font-size:3.5rem; display:inline-block; animation:bounce 1.6s ease-in-out infinite; }
@keyframes bounce { 0%,100%{transform:translateY(0) rotate(4deg)} 50%{transform:translateY(-20px) rotate(-3deg)} }
.loading-txt { color:rgba(255,255,255,.82); font-size:.95rem; margin-top:20px; animation:pulse 1.5s infinite; }
@keyframes pulse { 0%,100%{opacity:.45} 50%{opacity:1} }

/* ===== SHIORI ===== */
#shiori { display:none; animation:fadeUp .8s ease; }
#shiori.show { display:block; }

.s-cover {
  background:linear-gradient(145deg, #fff9e8, #ffe8d6);
  border-radius:26px 26px 0 0;
  padding:30px 22px 22px; text-align:center;
  position:relative; overflow:hidden;
  box-shadow:0 -4px 24px rgba(0,0,0,.1);
}
.s-cover-title { font-family:'Pacifico',cursive; font-size:1.75rem; color:var(--salmon); margin-bottom:4px; }
.s-cover-sub { font-size:.7rem; color:#b09080; letter-spacing:3px; text-transform:uppercase; }
.s-emoji { font-size:2rem; margin:14px 0 6px; }
.s-dest { font-family:'Zen Maru Gothic',sans-serif; font-size:1.5rem; font-weight:900; color:#3a1a0a; }
.s-copy { font-size:.82rem; color:#8a6050; margin-top:5px; font-style:italic; }
.s-badges { display:flex; justify-content:center; gap:8px; flex-wrap:wrap; margin-top:14px; }
.badge {
  background:rgba(255,107,157,.1); border:1px solid rgba(255,107,157,.28);
  border-radius:100px; padding:4px 11px;
  font-size:.72rem; color:#c05080; font-weight:700;
}
.badge.theme {
  background:rgba(255,221,87,.13); border-color:rgba(210,150,0,.28); color:#a07010;
}

.s-body {
  background:var(--cream); padding:20px 18px 30px;
  border-radius:0 0 26px 26px;
  box-shadow:0 20px 55px rgba(0,0,0,.14);
}

.day-block { margin-bottom:22px; }
.day-head { display:flex; align-items:center; gap:10px; margin-bottom:12px; }
.day-label {
  color:white; font-family:'Zen Maru Gothic',sans-serif;
  font-weight:900; font-size:.72rem;
  padding:4px 12px; border-radius:100px; white-space:nowrap;
}
.day-ttl { font-family:'Zen Maru Gothic',sans-serif; font-weight:700; font-size:.95rem; color:#2a1a0a; }

.timeline { position:relative; padding-left:20px; }
.timeline::before {
  content:''; position:absolute; left:6px; top:0; bottom:0;
  width:2px; border-radius:2px;
}
.tl-item { position:relative; margin-bottom:13px; }
.tl-dot {
  position:absolute; left:-17px; top:7px;
  width:10px; height:10px; border-radius:50%;
  border:2px solid white; box-shadow:0 2px 6px rgba(0,0,0,.15);
}
.tl-time { font-size:.7rem; font-weight:700; letter-spacing:1px; margin-bottom:3px; }
.act-card {
  border-radius:13px; padding:11px 13px;
  box-shadow:0 3px 14px rgba(0,0,0,.07);
  border-left:3px solid;
  transition:transform .2s, box-shadow .2s;
  cursor:default;
}
.act-card:hover { transform:translateX(4px); box-shadow:0 6px 22px rgba(0,0,0,.1); }
.act-name { font-family:'Zen Maru Gothic',sans-serif; font-weight:700; font-size:.9rem; color:#2a1a0a; margin-bottom:3px; }
.act-desc { font-size:.77rem; color:#7a6a5a; line-height:1.55; }
.act-tags { display:flex; gap:5px; margin-top:6px; flex-wrap:wrap; }
.act-tag { font-size:.64rem; padding:2px 8px; border-radius:100px; font-weight:700; border:1px solid; }

.divider { text-align:center; font-size:1.1rem; margin:14px 0; opacity:.4; }

.tips-box {
  background:linear-gradient(135deg, #e8f4ff, #f0e8ff);
  border-radius:17px; padding:17px; margin-top:8px;
  border:1px dashed rgba(130,80,200,.28);
}
.tips-title { font-family:'Zen Maru Gothic',sans-serif; font-weight:700; font-size:.86rem; color:#6040b0; margin-bottom:10px; }
.tip-row {
  font-size:.78rem; color:#5a4a7a; padding:6px 0;
  border-bottom:1px dashed rgba(130,80,200,.18); line-height:1.55;
}
.tip-row:last-child { border-bottom:none; }

.s-footer { text-align:center; margin-top:24px; font-size:1.5rem; }
.s-credit { text-align:center; color:#ccc; font-size:.68rem; margin-top:8px; }

.btn-back {
  display:block; width:100%; margin-top:18px; padding:14px;
  border:2px solid rgba(255,255,255,.44); border-radius:100px;
  background:transparent; color:white;
  font-family:'Zen Maru Gothic',sans-serif; font-weight:700;
  font-size:.9rem; cursor:pointer; transition:background .25s;
}
.btn-back:hover { background:rgba(255,255,255,.14); }

@keyframes fadeUp { from{opacity:0;transform:translateY(28px)} to{opacity:1;transform:translateY(0)} }
</style>
</head>
<body>

<div id="stars"></div>
<div id="clouds"></div>
<div id="plane">âœˆï¸</div>

<div id="app">

  <!-- HEADER -->
  <div class="header">
    <div class="logo">tabisora</div>
    <div class="tagline">âœ¨ æ—…ã®ã—ãŠã‚Šãƒ¡ãƒ¼ã‚«ãƒ¼ âœ¨</div>
  </div>

  <!-- FORM -->
  <div class="glass" id="formCard">
    <div class="card-title">ğŸ—ºï¸ æ—…ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã­</div>

    <div class="field">
      <label>ğŸ“ å‡ºç™ºåœ°</label>
      <input id="f-dep" type="text" placeholder="ä¾‹ï¼šæ±äº¬ã€å¤§é˜ªã€ç¦å²¡...">
    </div>

    <div class="field">
      <label>ğŸ—“ï¸ æ—…ã®æœŸé–“</label>
      <select id="f-dur">
        <option value="">é¸ã‚“ã§ã­</option>
        <option>æ—¥å¸°ã‚Šï¼ˆ0æ³Š1æ—¥ï¼‰</option>
        <option>1æ³Š2æ—¥</option>
        <option>2æ³Š3æ—¥</option>
        <option>3æ³Š4æ—¥</option>
        <option>4æ³Š5æ—¥</option>
        <option>ç´„1é€±é–“ï¼ˆ6ã€œ7æ—¥ï¼‰</option>
      </select>
    </div>

    <div class="field">
      <label>ğŸ¨ æ—…ã®ãƒ†ãƒ¼ãƒï¼ˆè¤‡æ•°OKï¼‰</label>
      <div class="pills" id="themePills">
        <div class="pill" data-v="ã‚°ãƒ«ãƒ¡">ğŸœ ã‚°ãƒ«ãƒ¡</div>
        <div class="pill" data-v="è‡ªç„¶ãƒ»çµ¶æ™¯">ğŸŒ„ è‡ªç„¶ãƒ»çµ¶æ™¯</div>
        <div class="pill" data-v="ã‚«ãƒ•ã‚§å·¡ã‚Š">â˜• ã‚«ãƒ•ã‚§å·¡ã‚Š</div>
        <div class="pill" data-v="æ­´å²ãƒ»æ–‡åŒ–">â›©ï¸ æ­´å²ãƒ»æ–‡åŒ–</div>
        <div class="pill" data-v="ã‚¤ãƒ³ã‚¹ã‚¿æ˜ ãˆ">ğŸ“¸ ã‚¤ãƒ³ã‚¹ã‚¿æ˜ ãˆ</div>
        <div class="pill" data-v="æ¸©æ³‰ãƒ»ç™’ã—">â™¨ï¸ æ¸©æ³‰ãƒ»ç™’ã—</div>
        <div class="pill" data-v="ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£">ğŸ„ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</div>
        <div class="pill" data-v="ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°">ğŸ›ï¸ ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°</div>
        <div class="pill" data-v="ã‚¢ãƒ‹ãƒ¡ãƒ»ãƒãƒƒãƒ—ã‚«ãƒ«ãƒãƒ£ãƒ¼">ğŸŒ ã‚¢ãƒ‹ãƒ¡ãƒ»ãƒãƒƒãƒ—ã‚«ãƒ«ãƒãƒ£ãƒ¼</div>
        <div class="pill" data-v="å¤œæ™¯ãƒ»ãƒãƒ¼">ğŸŒƒ å¤œæ™¯ãƒ»ãƒãƒ¼</div>
      </div>
    </div>

    <div class="field">
      <label>ğŸš— ç§»å‹•æ–¹æ³•</label>
      <div class="transports" id="transPills">
        <div class="tp" data-v="âœˆï¸ é£›è¡Œæ©Ÿ"><span class="ic">âœˆï¸</span>é£›è¡Œæ©Ÿ</div>
        <div class="tp" data-v="ğŸš„ æ–°å¹¹ç·š"><span class="ic">ğŸš„</span>æ–°å¹¹ç·š</div>
        <div class="tp" data-v="ğŸš— ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼"><span class="ic">ğŸš—</span>ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼</div>
        <div class="tp" data-v="ğŸšŒ ãƒã‚¹"><span class="ic">ğŸšŒ</span>ãƒã‚¹</div>
        <div class="tp" data-v="ğŸš¢ ãƒ•ã‚§ãƒªãƒ¼"><span class="ic">ğŸš¢</span>ãƒ•ã‚§ãƒªãƒ¼</div>
      </div>
    </div>

    <div class="field">
      <label>ğŸŒ è¡Œãå…ˆï¼ˆä»»æ„ï¼‰</label>
      <input id="f-dest" type="text" placeholder="ä¾‹ï¼šäº¬éƒ½ã€åŒ—æµ·é“ã€æ²–ç¸„ã€å°æ¹¾...">
    </div>

    <div class="field">
      <label>ğŸ’¬ ã²ã¨ã“ã¨å¸Œæœ›ï¼ˆä»»æ„ï¼‰</label>
      <textarea id="f-memo" rows="2" placeholder="ä¾‹ï¼šå¥³å­æ—…2äººã€äºˆç®—1æ—¥1ä¸‡å††ã€è‡ªç„¶ãŒå¥½ã..."></textarea>
    </div>

    <div class="err" id="errMsg"></div>
    <button class="btn-submit" id="btnSubmit" onclick="onSubmit()">âœˆï¸ ã—ãŠã‚Šã‚’ä½œã‚‹ï¼</button>
  </div>

  <!-- LOADING -->
  <div id="loading">
    <div class="plane-bounce">âœˆï¸</div>
    <div class="loading-txt" id="loadTxt">æ—…ã®ã—ãŠã‚Šã‚’ä½œæˆä¸­...</div>
  </div>

  <!-- SHIORI -->
  <div id="shiori">
    <div id="shioriContent"></div>
    <button class="btn-back" onclick="goBack()">â† ã‚‚ã†ä¸€åº¦ä½œã‚‹</button>
  </div>

</div><!-- /app -->

<script>
/* ===== ğŸ”‘ APIã‚­ãƒ¼ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ ===== */
const API_KEY = 'sk-ant-xxxxxxxxxxxxxxxxxx'; // â† ã“ã“ã‚’è‡ªåˆ†ã®ã‚­ãƒ¼ã«å¤‰æ›´

/* ===== STARS ===== */
const starsEl = document.getElementById('stars');
for(let i=0;i<75;i++){
  const s=document.createElement('div'); s.className='star';
  const sz=Math.random()*2.5+1;
  s.style.cssText=`left:${Math.random()*100}%;top:${Math.random()*100}%;width:${sz}px;height:${sz}px;--d:${2+Math.random()*3}s;--dl:${Math.random()*4}s`;
  starsEl.appendChild(s);
}

/* ===== CLOUDS ===== */
const cloudsEl=document.getElementById('clouds');
[[130,42,'13%','26s','0s',.5],[185,56,'55%','37s','-9s',.62],[90,30,'33%','21s','-5s',.38],[155,48,'73%','41s','-17s',.68]].forEach(([w,h,t,d,dl,o])=>{
  const c=document.createElement('div'); c.className='cloud';
  c.style.cssText=`width:${w}px;height:${h}px;top:${t};opacity:${o};--d:${d};--dl:${dl}`;
  cloudsEl.appendChild(c);
});

/* ===== PILLS ===== */
document.querySelectorAll('.pill').forEach(p=>p.onclick=()=>p.classList.toggle('on'));
document.querySelectorAll('.tp').forEach(p=>p.onclick=()=>{
  document.querySelectorAll('.tp').forEach(x=>x.classList.remove('on'));
  p.classList.add('on');
});

/* ===== LOADING MESSAGES ===== */
const LOAD_MSGS=['æ—…ã®ã—ãŠã‚Šã‚’ä½œæˆä¸­...','âœ¨ ãŠã™ã™ã‚ã‚¹ãƒãƒƒãƒˆæ¢ã—ã¦ã‚‹ã‚ˆ...','ğŸ—ºï¸ ãƒ«ãƒ¼ãƒˆã‚’è€ƒãˆã¦ã‚‹ã‚ˆ...','ğŸŒŸ ã‚‚ã†ã™ãå‡ºç™ºï¼'];
let loadIdx=0, loadTimer=null;
function startLoadMsgs(){
  loadIdx=0;
  document.getElementById('loadTxt').textContent=LOAD_MSGS[0];
  loadTimer=setInterval(()=>{
    loadIdx=(loadIdx+1)%LOAD_MSGS.length;
    document.getElementById('loadTxt').textContent=LOAD_MSGS[loadIdx];
  },1800);
}
function stopLoadMsgs(){ clearInterval(loadTimer); }

/* ===== COLORS ===== */
const COLORS=[
  {b:'#ff7c5c',bg:'#fff5f2'},{b:'#ff9a5c',bg:'#fff8f0'},
  {b:'#ffb347',bg:'#fffbf0'},{b:'#ff6b9d',bg:'#fff0f6'},
  {b:'#9b59b6',bg:'#f8f0ff'},{b:'#3498db',bg:'#f0f8ff'},
  {b:'#2ecc71',bg:'#f0fff4'}
];

/* ===== SUBMIT ===== */
async function onSubmit(){
  const dep=document.getElementById('f-dep').value.trim();
  const dur=document.getElementById('f-dur').value;
  const themes=[...document.querySelectorAll('.pill.on')].map(p=>p.dataset.v);
  const trans=(document.querySelector('.tp.on')||{}).dataset?.v||'';
  const dest=document.getElementById('f-dest').value.trim();
  const memo=document.getElementById('f-memo').value.trim();
  const errEl=document.getElementById('errMsg');

  errEl.classList.remove('show');
  if(!dep){showErr('ğŸ“ å‡ºç™ºåœ°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼');return;}
  if(!dur){showErr('ğŸ—“ï¸ æ—…ã®æœŸé–“ã‚’é¸ã‚“ã§ãã ã•ã„ï¼');return;}
  if(!themes.length){showErr('ğŸ¨ ãƒ†ãƒ¼ãƒã‚’1ã¤ä»¥ä¸Šé¸ã‚“ã§ãã ã•ã„ï¼');return;}
  if(!trans){showErr('ğŸš— ç§»å‹•æ–¹æ³•ã‚’é¸ã‚“ã§ãã ã•ã„ï¼');return;}

  document.getElementById('formCard').style.display='none';
  document.getElementById('loading').classList.add('show');
  startLoadMsgs();

  const prompt=`ã‚ãªãŸã¯æ—…è¡Œãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã§ã™ã€‚ä»¥ä¸‹ã®æ¡ä»¶ã§æ—…ã®ã—ãŠã‚Šã‚’JSONå½¢å¼ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚

æ¡ä»¶ï¼š
- å‡ºç™ºåœ°: ${dep}
- è¡Œãå…ˆ: ${dest||'ï¼ˆé­…åŠ›çš„ãªå ´æ‰€ã‚’ææ¡ˆã—ã¦ãã ã•ã„ï¼‰'}
- æœŸé–“: ${dur}
- ãƒ†ãƒ¼ãƒ: ${themes.join('ã€')}
- ç§»å‹•æ–¹æ³•: ${trans}
- ãã®ä»–: ${memo||'ãªã—'}

å¿…ãšä»¥ä¸‹ã®JSONå½¢å¼ã®ã¿ã§è¿”ç­”ã—ã¦ãã ã•ã„ï¼ˆã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ä¸è¦ã€å‰ç½®ãä¸è¦ï¼‰ï¼š
{"destination":"æ—…ã®ç›®çš„åœ°å","catchcopy":"ã“ã®æ—…ã‚’è¡¨ã™ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼20æ–‡å­—ä»¥å†…","emoji":"çµµæ–‡å­—3ã€œ4å€‹","days":[{"day":"1æ—¥ç›®","title":"ãã®æ—¥ã®ãƒ†ãƒ¼ãƒ","schedule":[{"time":"9:00","place":"å ´æ‰€å","description":"èª¬æ˜30æ–‡å­—ç¨‹åº¦","tags":["ã‚¿ã‚°1","ã‚¿ã‚°2"]}]}],"tips":["æ—…ã®tip1","tip2","tip3"]}

æœŸé–“ã«å¿œã˜ãŸæ—¥æ•°ã®daysã‚’ä½œæˆã€‚å„æ—¥4ã€œ5å€‹ã®scheduleã€‚`;

  try{
    const res=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'x-api-key': API_KEY,
        'anthropic-version':'2023-06-01',
        'anthropic-dangerous-direct-browser-access':'true'
      },
      body:JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:1000,
        messages:[{role:'user',content:prompt}]
      })
    });
    const data=await res.json();
    const txt=(data.content||[]).map(b=>b.text||'').join('');
    const clean=txt.replace(/```json|```/g,'').trim();
    const json=JSON.parse(clean);

    stopLoadMsgs();
    document.getElementById('loading').classList.remove('show');
    renderShiori(json,{dep,dur,themes,trans});
    document.getElementById('shiori').classList.add('show');

  }catch(e){
    stopLoadMsgs();
    document.getElementById('loading').classList.remove('show');
    document.getElementById('formCard').style.display='block';
    if(!API_KEY||API_KEY.includes('xxxxxxxxx')||API_KEY.length<20){
      showErr('ğŸ”‘ APIã‚­ãƒ¼ãŒæœªè¨­å®šã§ã™ã€‚index.htmlã‚’ãƒ¡ãƒ¢å¸³ã§é–‹ã3è¡Œç›®ã«APIã‚­ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
    } else if(location.protocol==='file:'){
      showErr('ğŸŒ file://ã§ã¯å‹•ãã¾ã›ã‚“ã€‚åŒå°ã® start.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ http://localhost:8000 ã§é–‹ã„ã¦ãã ã•ã„ã€‚');
    } else {
      showErr('ğŸ˜¢ ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚APIã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
    }
  }
}

function showErr(msg){
  const el=document.getElementById('errMsg');
  el.textContent=msg; el.classList.add('show');
}

/* ===== RENDER SHIORI ===== */
function renderShiori(d, meta){
  let html=`
  <div class="s-cover">
    <div class="s-cover-title">æ—…ã®ã—ãŠã‚Š</div>
    <div class="s-cover-sub">My Travel Notebook</div>
    <div class="s-emoji">${d.emoji||'âœˆï¸ğŸŒŸğŸ—ºï¸'}</div>
    <div class="s-dest">${esc(d.destination)}</div>
    <div class="s-copy">"${esc(d.catchcopy)}"</div>
    <div class="s-badges">
      <span class="badge">ğŸ“ ${esc(meta.dep)}ç™º</span>
      <span class="badge">ğŸ“… ${esc(meta.dur)}</span>
      <span class="badge">${esc(meta.trans)}</span>
    </div>
    <div class="s-badges" style="margin-top:7px;">
      ${meta.themes.map(t=>`<span class="badge theme">${esc(t)}</span>`).join('')}
    </div>
  </div>
  <div class="s-body">`;

  (d.days||[]).forEach((day,di)=>{
    const c=COLORS[di%COLORS.length];
    html+=`
    <div class="day-block">
      <div class="day-head">
        <span class="day-label" style="background:linear-gradient(135deg,${c.b},${c.b}99)">${esc(day.day)}</span>
        <span class="day-ttl">${esc(day.title)}</span>
      </div>
      <div class="timeline" style="--lc:${c.b}">
        <style>.timeline::before{background:linear-gradient(to bottom,${c.b}80,${c.b}22)}</style>`;

    (day.schedule||[]).forEach(item=>{
      html+=`
      <div class="tl-item">
        <div class="tl-dot" style="background:${c.b}"></div>
        <div class="tl-time" style="color:${c.b}">â° ${esc(item.time)}</div>
        <div class="act-card" style="background:${c.bg};border-left-color:${c.b}">
          <div class="act-name">${esc(item.place)}</div>
          <div class="act-desc">${esc(item.description)}</div>
          ${(item.tags||[]).length?`<div class="act-tags">${item.tags.map(t=>`<span class="act-tag" style="color:${c.b};border-color:${c.b}44;background:${c.bg}">${esc(t)}</span>`).join('')}</div>`:''}
        </div>
      </div>`;
    });

    html+=`</div></div>`;
    if(di<(d.days||[]).length-1) html+=`<div class="divider">âœ¦ âœ¦ âœ¦</div>`;
  });

  if((d.tips||[]).length){
    html+=`<div class="tips-box">
      <div class="tips-title">ğŸ’¡ æ—…ã®ãƒ’ãƒ³ãƒˆãƒ»æŒã¡ç‰©ãƒã‚§ãƒƒã‚¯</div>
      ${d.tips.map(t=>`<div class="tip-row">â€¢ ${esc(t)}</div>`).join('')}
    </div>`;
  }

  html+=`<div class="s-footer">âœˆï¸ ğŸŒŸ è‰¯ã„æ—…ã‚’ï¼ ğŸŒŸ âœˆï¸</div>
         <div class="s-credit">created by tabisora</div>
  </div>`;

  document.getElementById('shioriContent').innerHTML=html;
}

function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

/* ===== BACK ===== */
function goBack(){
  document.getElementById('shiori').classList.remove('show');
  document.getElementById('shioriContent').innerHTML='';
  document.getElementById('formCard').style.display='block';
  window.scrollTo({top:0,behavior:'smooth'});
}
</script>
</body>
</html>
